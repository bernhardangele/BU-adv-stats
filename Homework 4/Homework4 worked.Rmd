---
title: "Homework 4 - Worked example"
output: word_document
---

```{r, echo = FALSE}
# echo = FALSE will keep the code and its output from appearing in the final document.
library(ez)
library(knitr)

# round all numbers to the 2nd digit
options(digits = 2)

# in R Markdown, you do not STRICTLY need to set the working directory
# RStudio will automatically set the working directory to the directory that contains the Rmd file.
# Still, it might be a good idea to set it just to make things explicit:

# Remove the # sign to have R run the setwd command.
# Note that the following path will NOT work on your computer. Change it to the actual source file location
# You can get this from RStudio by selecting Session --> Set Working Directory --> To Source File Location
# copy and paste the resulting setwd command over the command below.
#setwd("C:/replace_this_with_your_actual_working_directory/")

food <- read.csv("Homework4_data.csv")

# add a subject column for ezANOVA
# very simple: each observation is a different person
# "subject" is a discrete variable, so make it a factor()
food$subject <- factor(food$subject)

food_stats <- ezStats(data = food, 
                       dv = eaten, 
                       wid = subject, 
                       between =  breed,
                       within = .(fish, beef))


food_stats_collapsed <- ezStats(data = food, 
                       dv = eaten, 
                       wid = subject, 
                       between_full =  breed,
                       within = .(fish, beef))


food_stats_by_breed <- ezStats(data = food, 
                       dv = eaten, 
                       wid = subject, 
                       between =  breed,
                       within_full = .(fish, beef))
```

In order to evaluate the effect of study breed, fish content, and beef content on cat food consumpton, we performed a 2x2x4 mixed ANOVA with amount food eaten (in g) as the dependent variable and breed (Shorthair vs. Persian vs. Siamese vs. Manx), fish content of the cat food (fish vs. no fish), and beef content of the cat food (beef vs. no beef) as independent variables. Table 1 and Figure 1 show the condition means.

*Table 1. Means, sample sizes (N), standard deviations (SD), and standard errors (SE) for the breeds and cat food conditions.*
```{r, results='asis', echo=FALSE}
# need results = "asis" so that the table is drawn properly
# get rid of the last column of food_stats (you don't need Fisher's LSD in a results section)
food_stats <- food_stats[,-length(food_stats)]
# Assign new column names to make the table look more professional (properly capitalised)
colnames(food_stats)[1:3] <- c("Breed", "Fish", "Beef")
# add a standard error column
food_stats$SE <- food_stats$SD/sqrt(food_stats$N)
# make a nice-looking table  
kable(food_stats)
```

*Figure 1. Condition means. Error bars denote 95% confidence intervals based on Fisher's Least Significant Difference.*

```{r, echo=FALSE}
library(ggplot2)
# I know I told you to use barplots and that CIs based on Fisher's LSD aren't ideal, but for this homework and for Assignment 1, it's fine to use them -- everything is just so much easier with ezPlot. If you want to know the details of how to make a plot without ezPlot, please ask me.

ezPlot(data = food, 
  dv = eaten, 
  wid = subject, 
  between =  breed,
  within = .(fish, beef),
  x = fish,
  split = beef,
  row = breed,
  x_lab = "Fish",
  y_lab = "Mean cat food eaten (in g)",
  split_lab = "Beef")
```

```{r, echo=FALSE}
# perform the actual ANOVA so we can use the results when writing our report
food_anova <- ezANOVA(data = food, 
                      dv = eaten,
                      wid = subject, 
                      between = breed,
                      within = .(fish, beef),
                      return_aov = TRUE)

food_anova_just_breed <- ezANOVA(data = food, 
                      dv = eaten,
                      wid = subject, 
                      between = breed,
                      within_full = .(fish, beef),
                      return_aov = TRUE)


# get the residuals for normality check
#food_anova_resid <- resid(food_anova$aov)

# Can't perform the Shapiro-Wilk test, since it's a repeated measures analysis
# This is not ideal, but can't be helped (see Class 4 presentation)
food_anova_shapiro <- shapiro.test(food$eaten)

# in order to do the pairwise t-test properly, we need to collapse over the within subject variables
# This can be done most easily with "melt" and "cast" from the "reshape" package
# I'm just doing this here for the sake of completeness.
# You won't have to do it in the assignment.
library(reshape)
food.m <- melt(food, measure = "eaten")
food.c <- cast(food.m, subject + breed ~ variable, mean)

food_anova_pairwise <- pairwise.t.test(x = food.c$eaten, g = food.c$breed)

# here's a little helper function to get the p-values printed right
print_p <- function(p){
  if(p < .01) return("*p* < .01")
  if(p <= .05) return(paste("*p* =", p))
  if(p > .05) return("*p* > .05")
}

# and a simple function to report F values
print_f_results <- function(ANOVA, effect_name){
  with(ANOVA[ANOVA$Effect == effect_name,], paste0("*F*(", DFn, ", ", DFd,") = ", round(F,2), " $\\eta_G^2$ = ", round(ges,2),", ", print_p(p)))
}


```

The ANOVA showed that overall, there was a significant main effect of fish content, `r print_f_results(food_anova$ANOVA, "fish")`, with cats eating more food when there was fish in it. There also was a significant main effect of beef content, `r print_f_results(food_anova$ANOVA, "beef")`, and a significant effect of breed, `r print_f_results(food_anova$ANOVA, "breed")`, with cats eating more food when there was beef in it. With regard to breed, there was no evidence that the homogeneity of variance assumption was violated (*p* > .05). 
The fish and beef main effects were modulated by a significant two-way interaction, `r print_f_results(food_anova$ANOVA, "fish:beef")`. This interaction showed that, when no beef was in the food, the cats ate more when there was fish in the food (mean eaten = 110 g) than when there was no fish (mean eaten = 67 g). When the food contained beef, cats ate less food when there was also fish in the food (mean eaten = 79 g) than when there was only beef (mean eaten = 90 g). None of the other interactions were significant (all *p*s > .05).

The Shapiro-Wilk test revealed no deviations from normality in the dependent variable (`r print_p(food_anova_shapiro$p.value)`).

Post-hoc pairwise *t*-tests (Holm-Bonferroni corrected) showed that Manx cats ate more food overall (112 g) than Shorthair cats (74 g; p < .05). The differences between Manx cats and Persian cats (82 g) and Siamese cats (79 g) did not reach significance. None of the other comparisons were significant. 

### Summary

Based on the results of our analyses, we can conclude that cats eat more food when it contains either fish or beef. However, cats don't seem to like it as much when their food contains both fish and beef together, as they eat less in that case. Cat breed does not seem to have an influence with regard to beef and fish preference. Some cat breeds (specifically, the Manx) do seem to eat more overall, but their preferences are the same as the other breeds'.